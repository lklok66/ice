======================================================================
Release notes for Ice Touch 1.1.0
======================================================================

Table of Contents
-----------------

  1. Introduction
  2. New Features
     - Changes and fixes in Ice Touch 1.1.0
     - Features added with Ice 1.1.0
  3. Ice Touch Feature Set
  4. SSL Support
  5. Loggers
  6. Garbage Collection
  7. Auto release pool
  8. Xcode project settings
  9. Accessory Transport


======================================================================
1. Introduction
======================================================================

Ice Touch offers an Objective-C language mapping, an Ice run time
for Mac OS X, and an Xcode SDK for Cocoa and iOS applications.

The Ice Touch distribution does not include any Ice services, but
its support for the complete Ice protocol means that your Ice Touch
applications can work seamlessly with existing Ice servers as well
as Ice services such as IceGrid, Glacier2, and IceStorm.

======================================================================
2. New Features
======================================================================

Changes and fixes in IceTouch 1.1.0
===================================

- The Ice Touch 1.0.0 AMI mapping was replaced with a new mapping. If
  your application is using AMI, you will need to update it to use the
  new AMI mapping. See below for more information on the new AMI
  mapping.

- SSL now works with the iOS simulator.

- The Xcode plugin now adds -all_load to the linker flags.

- The demos and tests were updated to support the iPad screen
  resolution.

- Ice threads are now registered with the garbage collector.

- The ICECallbackOnMainThread helper was removed. The new Ice
  dispatcher facility should be used instead. See below for more
  information.

- Un-marshalling now supports size checks to prevent memory over
  allocations by malicious clients or servers.

- The Xcode plugin now supports both 32 and 64 bits architectures.


Features added with IceTouch 1.1.0
==================================

Accessory Transport
-------------------

Ice Touch supports a new accessory transport to enable Ice Touch
applications to communicate with accessories connected to an iOS
device (either through USB or Bluetooth). The accessory must run an
Ice server with a custom transport to allow the communication. Refer
to section 9 below for more information.


New AMI mapping
---------------

This release features a completely new AMI facility that allows you to
structure your code with same flexibility as with the new AMI mapping
introduced with Ice 3.4.0. Callbacks are now specified using
Objectie-C blocks which provide much greater flexibility. 

TBD: Document the new mapping here? Or refer to the manual?

New Dispatcher facility
-----------------------

In previous releases, the developer of a graphical Ice application
would need to take precautions to make sure that updates to the user
interface were performed in the proper thread. For example, graphical
applications typically use AMI because it does not block the calling
thread, but AMI callbacks are invoked from an Ice run time thread.
Since the callback cannot update the user interface directly from such
a thread, it is forced to schedule an update instead. With Ice Touch
1.0.0, this was facilitated with the ICECallbackOnMainThread helper.

Ice Touch 1.1.0 introduces the same Dispatcher facility that was added
with Ice 3.4.0. The dispatcher lets you control the thread in which
servant methods and AMI callbacks are invoked. It is especially useful
for a graphical application, in which you can easily install a custom
dispatcher to guarantee that all of your servant and callback
invocations are made in a thread that can safely update the user
interface.

For example, to execute all Ice servant methods and AMI callbacks on
the main GUI thread, you just need to setup the following dispatcher
on communicator initialization:

  initData.dispatcher = ^(id<ICEDispatcherCall> call, id<ICEConnection> con)
  {
      dispatch_sync(dispatch_get_main_queue(), ^ { [call run]; });
  };

This technique is demonstrated in all the GUI demo applications from
the following directories:

- demo/Cocoa
- demo/iPhone


Support for background applications
-----------------------------------

TDB

New sample programs
-------------------

This release adds the following sample program:

  - demo/iPhone/voip

    Shows how to take advantage of Ice Touch background support.


======================================================================
3. Ice Touch Feature Set
======================================================================

Ice Touch supports the following features:

  - Objective-C mapping

This topic is described in the manual.

Ice Touch currently lacks support for the following Ice features:

  - Asynchronous method dispatch (AMD)
  - Collocation optimization
  - Servant locators
  - Implicit contexts
  - Protocol plug-ins
  - Local interfaces
  - Ice.Application and Ice.Service helper classes
  - Ice.Stats interface

Ice Touch has limited support for:

  - SSL

    Refer to Section 3 below for more information.

  - UDP

    On the iPhone, UDP requests do not transparently establish a
    3G/Edge connection.


======================================================================
4. SSL Support
======================================================================

Ice Touch for Mac OS X and Cocoa uses the Ice for C++ SSL
protocol plug-in.

For iOS devices, Ice Touch SSL provides only a subset of this
functionality. Due to limitations in iOS SSL support, the following
restriction applies:

  - Ice Touch servers cannot authenticate SSL clients.

Furthermore, the semantics of some IceSSL configuration properties
have changed, and new properties have been added. The IceSSL property
reference section of the Ice Touch manual provides complete details.


======================================================================
5. Loggers
======================================================================

Custom loggers must be installed via ICEInitializationData. You cannot
use any of the Ice for C++ logger properties, such as Ice.UseSyslog,
and you cannot install a custom logger with a plug-in (Ice.Plugin.*).


======================================================================
6. Garbage Collection
======================================================================

For MacOS X and Cocoa, the Ice Touch run time is built with garbage
collection support.

For iOS devices and the simulator, since garbage collection is not
supported, you must use explicit retain/release.

Due to the lack of GC, the Ice Touch run time for iOS cannot garbage
collect graphs of objects containing cycles. For example,

class Foo
{
    Foo next;
};

Foo a = [[Foo alloc] init];
Foo b = [[Foo alloc] init];
a.next = b;
b.next = a;

If you send this graph over the wire, your application will leak
memory unless you somehow retain the graph and manually break the
cycle.


======================================================================
7. Auto release pool
======================================================================

The Ice run time creates an NSAutoReleasePool object before each
server-side dispatched invocation and client-side AMI callback. The
pool is released once the dispatch is complete.


======================================================================
8. Xcode project settings
======================================================================

For Cocoa and iOS applications, which use the Xcode SDK, you must add
to "Additional SDKs"

  /Developer/SDKs/IceTouch-1.1/$(PLATFORM_NAME).sdk

In addition, for iOS applications, when creating a new Xcode project,
you set the "Code Signing Resource Rules Path" to:

  $(SDKROOT)/ResourceRules.plist

To set the path, select "Target", press "Info", select the "Build" tab,
and press "Select".

If you do not do this, you will receive an error signing your
application.

You must also add to the Frameworks folder:

 - CFNetwork.framework
 - Security.framework
 - Foundation.framework
 - ExternalAccessory.framework


======================================================================
9. Accessory Transport
======================================================================

The accessory transport enables Ice Touch clients running on an iOS
device to communicate with acccessories connected either via Bluetooth
or USB.

This transport is built on top of the iPhone OS External Accessory
framework. In order to use it, proxies must use the following
endpoint syntax:

  accessory [-p PROTOCOL] [-n NAME] [-m MANUFACTURER] [-o MODELNUMBER]

For example, to invoke on a proxy for the `hello' object running on an
accessory that implements the com.zeroc.helloWorld protocol, use the
following stringified proxy:

  hello:accessory -p com.zeroc.helloWorld

If the -p option is ommitted, the transport will lookup an accessory
that supports the `com.zeroc.ice' protocol by default. This protocol
string is application defined and must match the protocol string that
the accessory advertises.

In order to enable the accessory transport, Ice Touch applications
must add properties to the Ice communicator initialization property
set using the ICEConfigureAccessoryTransport method.

For example:

  ICEInitializationData* initData = [ICEInitializationData initializationData];
  initData.properties = [ICEUtil createProperties];
  ICEConfigureAccessoryTransport(initData.properties);
  communicator = [[ICEUtil createCommunicator:initData] retain];

This call will add the required properties and ensure that the
accessory transport is linked in with your application. The project
for your application will need to include the ExternalAccessory
framework as well.

To specify that your application supports a given acccessory protocol,
you need to set UISupportedExternalAccessoryProtocols in your project
Info.plist file. For example:

	<key>UISupportedExternalAccessoryProtocols</key>
	<array>
           <string>com.zeroc.helloWorld</string>
	</array>

The iPhone hello world demo from the demo/iPhone/hello directory
demonstrates how to configure the accessory transport.

In order to use the Ice Touch accessory transport, your accessory must
also support running an Ice server that is capable of receiving Ice
requests from Ice Touch over USB or Bluetooth. We can assist you with
the implementation of the Ice server side transport for your accessory.
For more information on this, please contact us at info@zeroc.com.
