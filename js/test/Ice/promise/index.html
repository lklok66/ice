<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stream Test | Ice for JavaScript</title>
    <style type="text/css">
        .console ul
        { 
            max-height: 300px; 
            min-height: 300px; 
            overflow-y: auto; 
            overflow-x: none;
            word-wrap:break-word;
        }
        ul {list-style-type: none;}
        nav h4 { margin-top: 10px; }
        .side-nav li.current b { color:orange; font-weight: bold; font-style:italic;}
    </style>
    <link rel="stylesheet" href="../../Common/foundation/css/foundation.css" />
    <script src="../../Common/foundation/js/modernizr.js"></script>
  </head>
  <body>
    
    <nav class="top-bar" data-topbar>
        <ul class="title-area">
            <li class="name">
                <h1><a href="#">Ice for JavaScript</a></h1>
            </li>
        </ul>
    </nav>
    
    <section role="main">
        <div class="row">
            <div class="large-2 medium-3 columns">
                <div class="sidebar">
                    <nav>
                        <h4>Test:</h4>
                        <ul class="side-nav tests"></ul>
                    </nav>
                </div>
            </div>
            <div class="large-10 medium-9 columns">
                <h3 id="grid">Output</h3>
                <hr>
                <div class="panel console">
                    <ul><li></li></ul>
                </div>
                <a href="#" class="button" id="run">Run</a>
            </div>
        </div>
    </section>
    <script src="../../Common/foundation/js/jquery.js"></script>
    <script src="../../Common/foundation/js/foundation.min.js"></script>
    <script src="../../../lib/Ice.js"></script>
    <script src="Test.js"></script>
    <script src="Client.js"></script>
    <script type="text/javascript">
    $(document).foundation();
    $(document).ready(
        function(){
            var TestCases = [
                "Ice/binding",
                "Ice/defaultValue",
                "Ice/enums",
                "Ice/exceptions",
                "Ice/facets",
                "Ice/inheritance",
                "Ice/invoke",
                "Ice/objects",
                "Ice/optional",
                "Ice/promise",
                "Ice/proxy",
                "Ice/slicing/exceptions",
                "Ice/slicing/objects",
                "Ice/stream"
            ];
            
            TestCases.forEach(
                function(name){
                    var s;
                    if(document.location.pathname.indexOf(name) !== -1)
                    {
                        s = "<li><b class=\"current\" href=\"#\">" + name + "</b></li>";
                    }
                    else
                    {
                        s = "<li><a href=\"..\\..\\" + name + "\\index.html\">" + name + "</a></li>";
                    }
                    $(".tests").append(s);
                });

            var panel = $(".console ul");
            var out = {};
            
            out.write = function(msg){
                var str = $( ".console ul li:last-child" ).text() + msg;
                $(".console ul li:last-child").html(str);
                panel.scrollTop(panel.get(0).scrollHeight);
            };
            
            out.writeLine = function(msg){
                this.write(msg);
                panel.append("<li></li>");
                panel.scrollTop(panel.get(0).scrollHeight);
            };
            
            var enabled = true;
            var runButton = $("#run");
            
            var runCurrentTest = function(){
                var current = $(".tests li.current");
                
                var id = new Ice.InitializationData();
                id.properties = Ice.createProperties();
                id.properties.setProperty("Ice.Default.Host", "localhost");
                id.properties.setProperty("Ice.Default.Protocol", "ws");
                        
                run(out, id).then(function()
                    {
                        runButton.removeClass("disabled");
                    },
                    function(ex)
                    {
                        var lines = ex.stack.split("\n");
                        for(i = 0; i < lines.length; ++i)
                        {
                            if(i === 0)
                            {
                                out.writeLine(lines[i]);
                            }
                            else
                            {
                                out.writeLine("&nbsp;&nbsp;&nbsp;"  + lines[i]);
                            }
                        }
                        runButton.removeClass("disabled");
                    });
            };
            
            runButton.click(function(){
                if(!runButton.hasClass("disabled"))
                {
                    $(".console ul").html("<li></li>");
                    runButton.addClass("disabled");
                    runCurrentTest();
                }
            });
        });
    </script>
    <div id="testscript"></div>
  </body>
</html>
