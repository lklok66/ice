<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello Demo | Ice for JavaScript</title>
    <style type="text/css">
        .console ul
        { 
            max-height: 300px; 
            min-height: 300px; 
            overflow-y: auto; 
            overflow-x: none;
            word-wrap:break-word;
        }
        ul {list-style-type: none;}
        nav h4 { margin-top: 10px; }
        .side-nav li.current a { color:orange; font-weight: bold; font-style:italic;}
    </style>
    <link rel="stylesheet" href="foundation/css/foundation.css" />
    <script src="foundation/js/modernizr.js"></script>
    <script src="../../../lib/Ice.js"></script>
    <script src="Hello.js"></script>
    <script src="Client.js"></script>
  </head>
  <body>
    <nav class="top-bar" data-topbar>
        <ul class="title-area">
            <li class="name">
                <h1><a href="#">Ice for JavaScript</a></h1>
            </li>
        </ul>
    </nav>
    <section role="main">
        <div class="row">
            <div class="large-12 medium-12 columns">
                <h3 id="grid">Output</h3>
                <hr>
                <div class="panel console">
                    <ul>
                        <li></li>
                    </ul>
                </div>
                <a href="#" class="button" id="run">Run</a>
            </div>
        </div>
    </section>
    <script src="foundation/js/jquery.js"></script>
    <script src="foundation/js/foundation.min.js"></script>
    <script>
        $(document).foundation();
      
        $(document).ready(function(){
        
            var panel = $(".console ul");
            var out = {};
            
            out.write = function(msg){
                var str = $( ".console ul li:last-child" ).text() + msg;
                $(".console ul li:last-child").html(str);
                panel.scrollTop(panel.get(0).scrollHeight);
            };
            
            out.writeLine = function(msg){
                this.write(msg);
                panel.append("<li></li>");
                panel.scrollTop(panel.get(0).scrollHeight);
            };
            
            out.writeException = function(ex){
                var lines = ex.stack.split("\n");
                for(i = 0; i < lines.length; ++i)
                {
                    if(i === 0)
                    {
                        this.writeLine(lines[i]);
                    }
                    else
                    {
                        this.writeLine("&nbsp;&nbsp;&nbsp;"  + lines[i]);
                    }
                }
            }
            
            var destroyCB = function(ex){
                if(ex !== undefined)
                {
                    out.writeException(ex);
                }
                runButton.removeClass("disabled");
            };
            
            var runButton = $("#run");
            
            var run = function(){
            
                var id = new Ice.InitializationData();
                id.properties = Ice.createProperties();
                id.properties.setProperty("Hello.Proxy", "hello:ws -h 127.0.0.1 -p 10000");
            
                var c = new Demo.Client();
                out.write("Sending request... ");
                c.run(id).then(
                    function(){ 
                        out.writeLine("ok");
                        c.destroy().then(destroyCB).exception(destroyCB); },
                    function(ex){
                        out.writeException(ex);
                        c.destroy().then(destroyCB).exception(destroyCB);
                    });
            };
            
            runButton.click(function(){
                if(!runButton.hasClass("disabled"))
                {
                    runButton.addClass("disabled");
                    run();
                }
            });
        });
    </script>
  </body>
</html>
