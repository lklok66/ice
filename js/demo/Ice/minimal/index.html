<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello Demo | Ice for JavaScript</title>
    <link rel="stylesheet" href="foundation/css/foundation.css" />
    <script src="foundation/js/modernizr.js"></script>
    <script src="../../../lib/Ice.js"></script>
    <script src="Hello.js"></script>
  </head>
  <body>
    <nav class="top-bar" data-topbar>
        <ul class="title-area">
            <li class="name">
                <h1><a href="#">Ice for JavaScript</a></h1>
            </li>
        </ul>
    </nav>
    <section role="main">
        <br/>
        <form>
            <div class="row">
                <div class="small-3 columns">
                    <label class="right inline" for="hostname">Hostname:</label>
                </div>
                <div class="small-9 columns">
                    <input type="text" id="hostname"/>
                </div>
                <div class="small-12 columns">
                    <a href="#" class="button small" id="hello">Hello World!</a>
                </div>
                <div class="small-12 columns">
                    <textarea id="console" readonly></textarea>
                </div>
            </div>
        </form>
    </section>
    <script src="foundation/js/jquery.js"></script>
    <script src="foundation/js/foundation.min.js"></script>
    <script>
        $(document).foundation();
        $(document).ready(
            function(){
                $("#hostname").attr("placeholder", document.location.hostname || "127.0.0.1");
                
                $("#hello").click(
                    function()
                    {
                        $("#console").val("");
                        var communicator = Ice.initialize();
                        var cleanup = function(ex)
                        {
                            if(ex instanceof Error)
                            {
                                $("#console").val(ex);
                            }
                            if(communicator !== null)
                            {
                                var c = communicator;
                                communicator = null;
                                return c.destroy();
                            }
                        };
                        
                        var exceptionCB = function(ex){ throw ex; };
                        
                        var hostname = $("#hostname").val() || $("#hostname").attr("placeholder");
                        Demo.HelloPrx.checkedCast(communicator.stringToProxy("hello:ws -h " + hostname + " -p 10000")).then(
                            function(asyncResult, hello)
                            {
                                return hello.sayHello();
                            },
                            exceptionCB
                        ).then(cleanup, exceptionCB).exception(cleanup);
                        return false;
                    });
            });
    </script>
  </body>
</html>
