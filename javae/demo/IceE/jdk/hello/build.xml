<!--
 **********************************************************************

 Copyright (c) 2003-2007 ZeroC, Inc. All rights reserved.

 This copy of Ice-E is licensed to you under the terms described in the
 ICEE_LICENSE file included in this distribution.

 **********************************************************************
-->

<project name="demo_IceE_jdk_hello" default="all" basedir=".">

    <!-- set global properties for this build -->
    <property name="top.dir" value="../../../.."/>

    <!-- Include common definitions -->
    <import file="${top.dir}/config/common.xml"/>

    <target name="init" depends="config-init"/>

    <target name="generate" depends="init">
        <!-- Create the output directory for generated code -->
        <mkdir dir="${generated.dir}"/>
        <slice2javae outputdir="${generated.dir}">
            <fileset dir="." includes="Hello.ice"/>
        </slice2javae>
    </target>

    <target name="compile" depends="generate">
        <mkdir dir="${class.dir}"/>
        <javac srcdir="${generated.dir}" destdir="${class.dir}" debug="${debug}" target="1.1"
            source="1.2" classpathref="jdk.classpath"/>
        <javac srcdir="." destdir="${class.dir}" excludes="generated/**" debug="${debug}" target="1.1"
            source="1.2" classpathref="jdk.classpath"/>
    </target>

    <target name="obfuscate" depends="compile" if="hasProguard">
	<taskdef resource="proguard/ant/task.properties"/>
	<proguard overloadaggressively="on" optimize="off" defaultpackage="" obfuscate="on"
	    allowaccessmodification="on" printseeds="off" usemixedcaseclassnames="off">
	    <injar path="classes:${jdk.lib.dir}/IceE.jar"/>
	    <outjar file="HelloClient.jar"/>
	    <libraryjar path="${java.home}/lib/rt.jar"/>
	    <keep name="Client">
		<method name="main"/>
	    </keep>
	</proguard>
	<proguard overloadaggressively="on" optimize="off" defaultpackage="" obfuscate="on"
	    allowaccessmodification="on" printseeds="off" usemixedcaseclassnames="off">
	    <injar path="classes:${jdk.lib.dir}/IceE.jar"/>
	    <outjar file="HelloServer.jar"/>
	    <libraryjar path="${java.home}/lib/rt.jar"/>
	    <keep name="Server">
		<method name="main"/>
	    </keep>
	</proguard>
    </target>

    <target name="all" depends="compile"/>

    <target name="clean">
        <delete dir="${generated.dir}"/>
        <delete dir="${class.dir}"/>
    </target>

</project>
