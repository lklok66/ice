<!--
 **********************************************************************

 Copyright (c) 2003-2008 ZeroC, Inc. All rights reserved.

 This copy of Ice is licensed to you under the terms described in the
 ICE_LICENSE file included in this distribution.

 **********************************************************************
-->

<icegrid>

    <application name="Test">
    <service-template id="IceFIX">
      <parameter name="instance-name" default="${application}.IceFIX"/>
      <parameter name="bridge-endpoints" default="default"/>
      <parameter name="fix-config"/>
      <parameter name="db-home" default=""/>
      <parameter name="retry-interval" default=""/>

      <service name="${instance-name}" entry="IceFIXService,10:create">

        <dbenv name="${service}" home="${db-home}"/>

        <adapter name="${service}.Bridge"
		 id="${instance-name}.Bridge" 
		 endpoints="${bridge-endpoints}">
          <object identity="${instance-name}/Bridge" type="::IceFIX::Bridge"/>
	</adapter>

        <properties>
           <property name="${service}.InstanceName" value="${instance-name}"/>
           <property name="${service}.FIXConfig" value="${fix-config}"/>
           <property name="${service}.RetryInterval" value="${retry-interval}"/>
        </properties>
      </service>

    </service-template>

    <server-template id="IceFIX">

      <parameter name="instance-name" default="${application}.IceFIX"/>
      <parameter name="bridge-endpoints" default="default"/>
      <parameter name="fix-config"/>
      <parameter name="db-home" default=""/>
      <parameter name="retry-interval" default=""/>

      <icebox id="${instance-name}" exe="icebox" activation="on-demand">
        <service-instance template="IceFIX"
			  instance-name="${instance-name}" 
			  bridge-endpoints="${bridge-endpoints}"
			  fix-config="${fix-config}"
			  retry-interval="${retry-interval}"
			  db-home="${db-home}"/>
      </icebox>

    </server-template>

    <node name="localnode">
      <server-instance
         template="IceFIX"
         instance-name="TP1"
         retry-interval="5"
	 fix-config="config.fix-tp1"/>
	 
      <server-instance
         template="IceFIX"
         instance-name="TP2"
         retry-interval="5"
	 fix-config="config.fix-tp2"/>

      <server id="FixTP1" exe="${test.dir}/server" activation="on-demand">
        <property name="InstanceName" value="FixTP1"/>
        <property name="FIXConfig" value="${test.dir}/config.tp1"/>
        <adapter name="FixTP1.FixServer" endpoints="default">
            <object identity="FixTP1/Control" type="::Test::Control"/>
        </adapter>
      </server>

      <server id="FixTP2" exe="${test.dir}/server" activation="on-demand">
        <property name="InstanceName" value="FixTP2"/>
        <property name="FIXConfig" value="${test.dir}/config.tp2"/>
        <adapter name="FixTP2.FixServer" endpoints="default">
            <object identity="FixTP2/Control" type="::Test::Control"/>
        </adapter>
      </server>
    </node>

  </application>

</icegrid>
