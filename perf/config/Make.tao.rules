# **********************************************************************
#
# Copyright (c) 2003-2012 ZeroC, Inc. All rights reserved.
#
# This copy of Ice is licensed to you under the terms described in the
# ICE_LICENSE file included in this distribution.
#
# **********************************************************************

ifeq ($(TAO_ROOT),)
      $(error Please define TAO_ROOT! See config/Make.rules)
endif

ifeq ($(ICE_HOME),)
      $(error Please define ICE_HOME! See config/Make.rules)
endif

include	 $(ICE_HOME)/config/Make.rules.$(UNAME)

CPPFLAGS	:= -I. -I$(top_srcdir)/include -I$(TAO_ROOT)/include -I$(ICE_HOME)/include $(CPPFLAGS)
CXXFLAGS	:= -O3 -pthread -Wall -D_REENTRANT

ifeq ($(DEBUG),yes)
     CXXFLAGS		:= -g $(CXXFLAGS)
endif

LDFLAGS		:=  -L$(TAO_ROOT)/lib $(LDPLATFORMFLAGS) 

ICE_LIBS		?= -L$(ICE_HOME)/lib -lIce -lIceUtil

.SUFFIXES:
.SUFFIXES:		.cc .cpp .o .py

%.h %.cpp: %.ice
	rm -f $(*F).h $(*F).cpp
	$(SLICE2CPP) $(SLICE2CPPFLAGS) $(*F).ice	

.cpp.o:
	$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $<

.cc.o:
	$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $<

depend:: $(SRCS)
	-rm -f .depend
	if test -n "$(SRCS)" ; then \
	    $(CXX) -DMAKEDEPEND -MM $(CXXFLAGS) $(CPPFLAGS) $^ | \
	       (ace=`echo "$$TAO_ROOT" | sed -e 's/\//\\\\\//g'` ; \
	        icedir=`echo "$$ICE_HOME" | sed -e 's/\//\\\\\//g'` ; \
	        while read line ; do  \
	            echo $$line | sed -e "s/$$ace/\$$(TAO_ROOT)/g" | \
	               sed -e "s/$$icedir/\$$(ICE_HOME)/g" ; \
		done) >> .depend ;\
	fi
