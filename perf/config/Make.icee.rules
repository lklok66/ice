# **********************************************************************
#
# Copyright (c) 2003-2014 ZeroC, Inc. All rights reserved.
#
# This copy of Ice is licensed to you under the terms described in the
# ICE_LICENSE file included in this distribution.
#
# **********************************************************************

ifeq ($(ICEE_HOME),)
    $(error ICEE_HOME must be defined to build Ice performance testing tools.)
endif

slicedir		= $(ICEE_HOME)/slice
configdir		= $(ICEE_HOME)/config

include	 $(configdir)/Make.rules.$(UNAME)

CPPFLAGS		=
ICECPPFLAGS		= -I$(slicedir)
SLICE2CPPFLAGS		= $(ICECPPFLAGS)

#
# Optimization rules come from the Ice distribution's config files.
#
ifeq ($(DEBUG),yes)
     CXXFLAGS		:= -g $(CXXFLAGS)
endif

LDFLAGS			= $(LDPLATFORMFLAGS) $(CXXFLAGS)

ICE_CPPFLAGS		?= -I$(ICEE_HOME)/include
ICE_LIBS		?= -L$(ICEE_HOME)/lib -lIceE

SLICE2CPP		= $(ICEE_HOME)/bin/slice2cppe

.SUFFIXES:
.SUFFIXES:		.cc .cpp .o .py

%.h %.cpp: %.ice
	rm -f $(*F).h $(*F).cpp
	$(SLICE2CPP) $(SLICE2CPPFLAGS) $(*F).ice	

.cpp.o:
	$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $<

.cc.o:
	$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $<

depend:: $(SRCS) $(SLICE_SRCS)
	-rm -f .depend .depend.mak
	if test -n "$(SRCS)" ; then \
	    $(CXX) -DMAKEDEPEND -M $(CXXFLAGS) $(CPPFLAGS) $(SRCS) | $(configdir)/makedepend.py; \
	fi

ifneq ($(TEMPLATE_REPOSITORY),)
clean::
	rm -fr $(TEMPLATE_REPOSITORY)
endif

